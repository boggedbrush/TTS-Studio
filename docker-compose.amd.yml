# AMD GPU (ROCm) configuration
# Usage: docker compose -f docker-compose.yml -f docker-compose.amd.yml up --build

services:
  backend:
    # Use ROCm Dockerfile
    build:
      context: ./backend
      dockerfile: Dockerfile.rocm
    # AMD GPU passthrough
    devices:
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    group_add:
      - video
    environment:
      - HSA_OVERRIDE_GFX_VERSION=10.3.0
      - PYTORCH_ROCM_ARCH=gfx1030
